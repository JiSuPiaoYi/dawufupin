{% extends "app_common/base_site.html" %}

{% block title %}贫困户数据信息{% endblock %}

{% block css %}
    <link rel="stylesheet" href="{{ STATIC_URL }}css/report_form/poorhousedataform/poorhousedataform.css"/>
{% endblock %}

{% block right_content %}
    <div class="page-header">
        <h3 class="breadcrumb" style="background-color:inherit;margin-bottom:0">
            <li>统计及报表</li>
            <li class="active">贫困户数据</li>
        </h3>
    </div>

    <div class="up">
        贫困户数据信息
    </div>

    <div class="middle">
        <div class="query_part">查询条件</div>
        <div class="show_part">
            <form role="form">
                <div class="div01">
                    <p class="town_tag">乡&nbsp;&nbsp;镇&nbsp;&nbsp;名&nbsp;&nbsp;称：</p>
                    <div class="town_part">
                        <select id="town_select">
                            <option value="请选择">请选择</option>
                            {% for t in town_name %}
                                <option value="{{ t }}">{{ t }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <p class="definition_tag">行&nbsp;政&nbsp;村&nbsp;名&nbsp;称：</p>
                    <div class="definition_part">
                        <select id="definition_select">
                            <option value="请选择">请选择</option>
                        </select>
                    </div>
                </div>
                <div class="div02">
                    <p class="householder_tag">户&nbsp;&nbsp;主&nbsp;&nbsp;姓&nbsp;&nbsp;名：</p>
                    <div class="form-group">
                        <label class="sr-only" for="householder">householder</label>
                        <input type="text"  id="householder" name="householder" class="form-control householder_input"/>
                    </div>
                    <p class="identity_tag">户主身份证号：</p>
                    <div class="form-group">
                        <label class="sr-only" for="identity">identity</label>
                        <input type="text"  id="identity" name="identity" class="form-control identity_input"/>
                    </div>
                </div>
                <div class="div03">
                    <p class="helper_tag">帮&nbsp;&nbsp;扶&nbsp;&nbsp;人&nbsp;&nbsp;员：</p>
                    <div class="form-group">
                        <label class="sr-only" for="helper">helper</label>
                        <input type="text"  id="helper" name="helper" class="form-control helper_input"/>
                    </div>
                    <p class="number_tag">家庭成员身份证号：</p>
                    <div class="form-group">
                        <label class="sr-only" for="number">number</label>
                        <input type="text"  id="number" name="number" class="form-control number_input"/>
                    </div>
                </div>
                <div class="div04">
                    <p class="poor_tag">贫&nbsp;困&nbsp;户&nbsp;属&nbsp;性：</p>
                    <div class="poor_part">
                        <select id="poor_select">
                            <option value="请选择">请选择</option>
                            <option value="五保户">五保户</option>
                            <option value="低保户">低保户</option>
                            <option value="一般农户">一般农户</option>
                            <option value="五保贫困户">五保贫困户</option>
                            <option value="低保贫困户">低保贫困户</option>
                            <option value="一般贫困户">一般贫困户</option>
                        </select>
                    </div>
                    <p class="reason_tag">主要致贫原因：</p>
                    <div class="reason_part">
                        <select id="reason_select">
                            <option value="请选择">请选择</option>
                            <option value="因学">因学</option>
                            <option value="因病">因病</option>
                            <option value="因残">因残</option>
                            <option value="因灾">因灾</option>
                            <option value="缺水">缺水</option>
                            <option value="缺土地">缺土地</option>
                            <option value="缺劳力">缺劳力</option>
                            <option value="缺技术">缺技术</option>
                            <option value="缺资金">缺资金</option>
                            <option value="自身发展动力不足">自身发展动力不足</option>
                            <option value="交通条件落后">交通条件落后</option>
                            <option value="其他">其他</option>
                        </select>
                    </div>
                </div>
                <div class="div05">
                    <button type="button" class="btn btn-default btn-sm" onclick="commit_form()">点击查询</button>
                    <button type="button" class="btn btn-default btn-sm" data-toggle="modal" data-target="#modal_show">显示全部</button>
                </div>
            </form>
        </div>
    </div>

    <div class="down" id="down_show" style="display:none;">
        <div class="list_part">
            <p class="p01">贫困户列表</p>
            {% if data_number %}
                <p class="p02">总计{{ data_number }}条数据</p>
            {% else %}
                <p class="p02">总计0条数据</p>
            {% endif %}
        </div>
        {% if poorhousedata_list %}
            <div class="specific_part">
                {% for p in poorhousedata_list %}
                    <div class="panel info_part">
                        <div class="panel-heading heading_part">
                            <span class="glyphicon glyphicon-menu-down down_span" onclick="collapse_up(this)"></span>
                            <span class="glyphicon glyphicon-menu-right right_span" onclick="collapse_down(this)"></span>
                            <span class="name_span">户主&nbsp;{{ p.householder_name }}</span>
                            <span class="family_span" onclick="convert_to_people('{{ p.house_identifier }}')">家庭人口数为{{ p.family_number }}</span>
                            <span class="attribute_span">贫困户属性为{{ p.poor_attribute }}</span>
                            <span class="village_span" onclick="convert_to_village('{{ p.now_village_identifier }}')">归属地：{{ p.town_name }}{{ p.now_village_name }}</span>
                            {% if '贫困户数据_编辑' in CODENAMES %}
                                <span class="glyphicon glyphicon-edit layui_span" onclick="edit_data('family','{{ p.householder_id }}')"></span>
                            {% endif %}
                        </div>
                        <div class="panel-body collapse">
                            <div class="first_layer">
                                <p>村编号：{{ p.now_village_identifier }}</p>
                                <p>户编号：{{ p.house_identifier }}/{{ p.householder_name }}</p>
                                <p>户主个人编号：{{ p.householder_identifier }}</p>
                            </div>
                            <div class="second_layer">
                                <p>户主身份证号：{{ p.householder_id }}</p>
                                <p>首次识别时间：{{ p.first_identify }}</p>
                                <p>主要致贫原因：{{ p.poor_reason }}</p>
                            </div>
                            <div class="third_layer">
                                <p>是否危房户：{{ p.danger_house }}</p>
                                <p>饮水是否安全：{{ p.water_safe }}</p>
                                <p>饮水是否困难：{{ p.water_hard }}</p>
                            </div>
                            <div class="fourth_layer">
                                <p>家庭人均纯收入：{{ p.average_income }}</p>
                                <p>户主联系电话：{{ p.telephone }}</p>
                                <p>脱贫属性：{{ p.offpoor_attribute }}</p>
                            </div>
                            <div class="fifth_layer">
                                <p>脱贫年度：{{ p.offpoor_year }}</p>
                                <p>住址：{{ p.address }}</p>
                                <p>帮扶人员：{{ p.help_people }}</p>
                            </div>
                            <div class="sixth_layer">
                                <p>帮扶单位：{{ p.help_unit }}</p>
                                <p>帮扶方式：{{ p.help_way }}</p>
                                <p>帮扶人员电话号码：{{ p.help_phone }}</p>
                            </div>
                            <div class="seventh_layer">
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <td>所属对象</td>
                                            <td>应享政策名称</td>
                                            <td>补助标准</td>
                                            <td>数量</td>
                                            <td>应享金额（元）</td>
                                            <td>实享金额（元）</td>
                                            <td>发放时间</td>
                                            <td>更多信息</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for item in p.additionaldata %}
                                        <tr>
                                            <td class="td_8">
                                                {% if '贫困户数据_编辑' in CODENAMES %}
                                                    <span class="glyphicon glyphicon-edit span_1" data-toggle="modal" data-target="#modal_edit" onclick="input_data(this,'{{ item.13 }}','{{ item.12 }}','{{ item.11 }}','{{ item.0 }}','{{ item.1 }}','{{ item.2 }}','{{ item.3 }}','{{ item.4 }}','{{ item.5 }}','{{ item.7 }}','{{ item.8 }}','{{ item.9 }}','{{ item.10 }}')"></span>
                                                {% endif %}
                                                <span>{{ item.11 }}</span>
                                            </td>
                                            <td class="td_1">
                                                <span class="td_1_span" onmouseover="showpolicy(this,'{{ item.0 }}')">{{ item.0 }}</span>
                                            </td>
                                            <td class="td_2">
                                                <span class="td_2_span" onmouseover="showstandard(this,'{{ item.1 }}')">{{ item.1 }}</span>
                                            </td>
                                            <td class="td_3">{{ item.2 }}</td>
                                            <td class="td_4">{{ item.3 }}</td>
                                            {% if item.6 == 'o' %}
                                                <td class="td_5" style="color:#FF9900;">{{ item.4 }}</td>
                                            {% else %}
                                                <td class="td_5">{{ item.4 }}</td>
                                            {% endif %}
                                            <td class="td_6">{{ item.5 }}</td>
                                            <td class="td_7">
                                                <span class="td_7_span" onmouseover="showmore(this,'{{ item.7 }}','{{ item.8 }}','{{ item.9 }}','{{ item.10 }}')">...</span>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
            <div class="paging">
                <div class="paging_edit">
                    <span onclick="convert_page({{ curpage }},{{ allpage }})">跳转</span>
                    <input type="text" id="pages" name="pages">
                </div>
                <div class="paging_mark">
                    {% ifnotequal curpage 1 %}    {# 如果当前页有上一页 #}
                        <span onclick="last_page({{ curpage }},{{ allpage }},'pagelast')" class="glyphicon glyphicon-chevron-left"></span>
                    {% endifnotequal %}
                    <span>
                        {{ curpage }}/{{ allpage }}    {# 当前页码/总页数 #}
                    </span>
                    {% ifnotequal curpage allpage %}    {# 如果当前页有下一页 #}
                        <span onclick="next_page({{ curpage }},{{ allpage }},'pagenext')" class="glyphicon glyphicon-chevron-right"></span>
                    {% endifnotequal %}
                </div>
            </div>
        {% else %}
            <div class="nodata_part">暂无数据</div>
        {% endif %}
    </div>

    <!-- 模态框（Modal） -->
    <div class="modal fade" id="modal_show" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabel">
                        提示
                    </h4>
                </div>
                <div class="modal-body">
                    由于数据量较大，显示全部数据需要等待较长时间，您确定要显示全部数据？
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="show_data()">确定</button>
                </div>
            </div>
        </div>
    </div>
    <!-- 模态框（Modal） -->

    <!-- 模态框（Modal） -->
    <div class="modal fade" id="modal_edit" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content" style="width:800px;">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="editModalLabel">
                        数据编辑
                    </h4>
                </div>
                <form role="form">
                    <div class="modal-body">
                        <div class="div1">
                            <p class="object_tag">所属对象：</p>
                            <div class="form-group">
                                <label class="sr-only" for="object">object</label>
                                <input type="text" id="object" name="object" readonly="readonly" class="form-control object_input"/>
                            </div>
                            <p class="policy_tag">应享政策名称：</p>
                            <div class="form-group">
                                <label class="sr-only" for="policy">policy</label>
                                <input type="text" id="policy" name="policy" readonly="readonly" class="form-control policy_input"/>
                            </div>
                        </div>
                        <div class="div2">
                            <p class="standard_tag">补助标准：</p>
                            <div class="form-group">
                                <label class="sr-only" for="standard">standard</label>
                                <input type="text" id="standard" name="standard" class="form-control standard_input"/>
                            </div>
                            <p class="multiplier_tag">数量：</p>
                            <div class="form-group">
                                <label class="sr-only" for="multiplier">multiplier</label>
                                <input type="text" id="multiplier" name="multiplier" class="form-control multiplier_input"/>
                            </div>
                        </div>
                        <div class="div3">
                            <p class="plan_tag">应享金额（元）：</p>
                            <div class="form-group">
                                <label class="sr-only" for="plan">plan</label>
                                <input type="text" id="plan" name="plan" class="form-control plan_input"/>
                            </div>
                            <p class="fact_tag">实享金额（元）：</p>
                            <div class="form-group">
                                <label class="sr-only" for="fact">fact</label>
                                <input type="text" id="fact" name="fact" class="form-control fact_input"/>
                            </div>
                        </div>
                        <div class="div4">
                            <p class="time_tag">发放时间：</p>
                            <div class="form-group">
                                <label class="sr-only" for="time">time</label>
                                <input type="text" id="time" name="time" class="form-control time_input"/>
                            </div>
                            <p class="bank_tag">收款银行：</p>
                            <div class="form-group">
                                <label class="sr-only" for="bank">bank</label>
                                <input type="text" id="bank" name="bank" class="form-control bank_input"/>
                            </div>
                        </div>
                        <div class="div5">
                            <p class="account_tag">收款账号：</p>
                            <div class="form-group">
                                <label class="sr-only" for="account">account</label>
                                <input type="text" id="account" name="account" class="form-control account_input"/>
                            </div>
                            <p class="receiver_tag">收款人姓名：</p>
                            <div class="form-group">
                                <label class="sr-only" for="receiver">receiver</label>
                                <input type="text" id="receiver" name="receiver" class="form-control receiver_input"/>
                            </div>
                        </div>
                        <div class="div6">
                            <p class="identification_tag">收款人身份证号：</p>
                            <div class="form-group">
                                <label class="sr-only" for="identification">identification</label>
                                <input type="text" id="identification" name="identification" class="form-control identification_input"/>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#modal_confirm_delete">删除该条数据</button>
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal_confirm_modify">修改该条数据</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- 模态框（Modal） -->

    <!-- 模态框（Modal） -->
    <div class="modal fade" id="modal_confirm_delete" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="deleteModalLabel">
                        提示
                    </h4>
                </div>
                <div class="modal-body">
                    该条数据删除后将无法恢复！您确定要删除该条数据？
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="delete_data()">确定</button>
                </div>
            </div>
        </div>
    </div>
    <!-- 模态框（Modal） -->

    <!-- 模态框（Modal） -->
    <div class="modal fade" id="modal_confirm_modify" tabindex="-1" role="dialog" aria-labelledby="modifyModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="modifyModalLabel">
                        提示
                    </h4>
                </div>
                <div class="modal-body">
                    您确定要修改该条数据？
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="modify_data()">确定</button>
                </div>
            </div>
        </div>
    </div>
    <!-- 模态框（Modal） -->
{% endblock %}

{% block script %}
    <script type="text/javascript">

        var ID_CODE,POLICY_NUMBER,DATE_YEAR,DATE_MONTH,SPAN_OBJECT,OBJECT,POLICY_NAME;

        //向模态框中传值
        function input_data(self,data_13,data_12,data_11,data_0,data_1,data_2,data_3,data_4,data_5,data_7,data_8,data_9,data_10){

            SPAN_OBJECT=$(self);

            ID_CODE=data_12;
            POLICY_NUMBER=data_13;
            DATE_YEAR=data_5.substr(0,4);
            DATE_MONTH=data_5.substr(5,data_5.length-5);
            OBJECT=data_11;
            POLICY_NAME=data_0;

            $("#object").val(data_11);
            $("#policy").val(data_0);
            $("#standard").val(data_1);
            $("#multiplier").val(data_2);
            $("#plan").val(data_3);
            $("#fact").val(data_4);
            $("#time").val(data_5);
            $("#bank").val(data_7);
            $("#account").val(data_8);
            $("#receiver").val(data_9);
            $("#identification").val(data_10);
        }

        //模态框之修改数据
        function modify_data(){
            layui.use('layer', function() {
                var $ = layui.jquery, layer = layui.layer;

                layer.msg('<i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop" style="font-size: 86px;margin-top: 65px;"></i>', {
                    time: 30000, //30s后自动关闭
                    shade:0.1,
                    area: ['220px', '180px']
                });
            });

            object=$("#object").val();
            standard=$("#standard").val();
            number=$("#multiplier").val();
            plan=$("#plan").val();
            fact=$("#fact").val();
            time=$("#time").val();
            bank=$("#bank").val();
            account=$("#account").val();
            receiver=$("#receiver").val();
            identification=$("#identification").val();
            id_code=ID_CODE;
            policy_number=POLICY_NUMBER;
            date_year=DATE_YEAR;
            date_month=DATE_MONTH;

            $.ajax({
                type: 'post',
                datatype:'json',
                url: '/report_form/house_data_modify/',
                data: {
                    "object":object,
                    "standard":standard,
                    "number":number,
                    "plan":plan,
                    "fact":fact,
                    "time":time,
                    "bank":bank,
                    "account":account,
                    "receiver":receiver,
                    "identification":identification,
                    "id_code":id_code,
                    "policy_number":policy_number,
                    "date_year":date_year,
                    "date_month":date_month
                },
                success: function(res){
                    html_text='<tr>'+
                            '<td class="td_8">'+
                                '<span class="glyphicon glyphicon-edit span_1" data-toggle="modal" data-target="#modal_edit" onclick="input_data(this,\''+POLICY_NUMBER+'\',\''+ID_CODE+'\',\''+OBJECT+'\',\''+POLICY_NAME+'\',\''+res['standard']+'\',\''+res['number']+'\',\''+res['plan']+'\',\''+res['fact']+'\',\''+res['time']+'\',\''+res['bank']+'\',\''+res['account']+'\',\''+res['receiver']+'\',\''+res['identification']+'\')"></span>'+
                                '<span>'+OBJECT+'</span>'+
                            '</td>'+
                            '<td class="td_1">'+
                                '<span class="td_1_span" onmouseover="showpolicy(this,\''+POLICY_NAME+'\')">'+POLICY_NAME+'</span>'+
                            '</td>'+
                            '<td class="td_2">'+
                                '<span class="td_2_span" onmouseover="showstandard(this,\''+res['standard']+'\')">'+res['standard']+'</span>'+
                            '</td>'+
                            '<td class="td_3">'+res['number']+'</td>'+
                            '<td class="td_4">'+res['plan']+'</td>'+
                            '<td class="td_5">'+res['fact']+'</td>'+
                            '<td class="td_6">'+res['time']+'</td>'+
                            '<td class="td_7">'+
                                '<span class="td_7_span" onmouseover="showmore(this,\''+res['bank']+'\',\''+res['account']+'\',\''+res['receiver']+'\',\''+res['identification']+'\')">...</span>'+
                            '</td>'+
                        '</tr>';

                    var parent_1=SPAN_OBJECT.parent();
                    var parent_2=parent_1.parent();
                    parent_2.before(html_text);
                    parent_2.remove();
                    layer.closeAll();
                }
            });

            $("#modal_edit").modal("hide");
        }

        //模态框之删除数据
        function delete_data(){
            layui.use('layer', function() {
                var $ = layui.jquery, layer = layui.layer;

                layer.msg('<i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop" style="font-size: 86px;margin-top: 65px;"></i>', {
                    time: 30000, //30s后自动关闭
                    shade:0.1,
                    area: ['220px', '180px']
                });
            });

            object=$("#object").val();
            id_code=ID_CODE;
            policy_number=POLICY_NUMBER;
            date_year=DATE_YEAR;
            date_month=DATE_MONTH;

            $.ajax({
                type: 'post',
                datatype:'json',
                url: '/report_form/house_data_delete/',
                data: {
                    "object":object,
                    "id_code":id_code,
                    "policy_number":policy_number,
                    "date_year":date_year,
                    "date_month":date_month
                },
                success: function(res){
                    var parent_1=SPAN_OBJECT.parent();
                    var parent_2=parent_1.parent();
                    parent_2.remove();
                    layer.closeAll();
                }
            });

            $("#modal_edit").modal("hide");
        }

        var TOWN,DEFINITION,HOUSEHOLDER,IDENTITY,HELPER,POOR,NUMBER,REASON;

        //贫困户列表展示之折叠面板
        function collapse_up(self) {
            $(self).hide();
            $(self).next().show();
            $(self).parents(".panel").find(".panel-body").collapse('hide');
        }

        //贫困户列表展示之展开面板
        function collapse_down(self) {
            $(self).hide();
            $(self).prev().show();
            $(self).parents(".panel").find(".panel-body").collapse('show');
        }

        //编辑按钮链接跳转
        function edit_data(type,id){
            window.open('/excel_view/search_correct/?type='+type+'&number='+id);
        }

        //贫困户页面点击合并后村名称跳转到贫困村页面
        function convert_to_village(now_village_identifier){
            window.open('/report_form/poorvillagedataform/?now_village_identifier='+now_village_identifier);
        }

        //贫困户页面点击家庭人口数跳转到贫困人口页面
        function convert_to_people(house_identifier){
            window.open('/report_form/poorpeopledataform/?house_identifier='+house_identifier);
        }

        //享受政策之鼠标悬停显示详细
        function showmore(self,bank_name,bank_number,card_people,people_id){
            $(self).popover({
                trigger:'manual',
                placement:'left',
                title:'更多信息',
                html:true,
                content:'<p>收款银行：'+bank_name+'<P><p>收款账号：'+bank_number+'</p><p>收款人姓名：'+card_people+'</p><p>收款人身份证号：'+people_id+'</p>'
            }).on('mouseleave',function(){
                    $(self).popover('hide');
            });
            $(self).popover('show');
        }

        //享受政策之鼠标悬停显示详细
        function showpolicy(self,policy){
            $(self).popover({
                trigger:'manual',
                placement:'top',
                title:'应享政策名称',
                html:true,
                content:policy
            }).on('mouseleave',function(){
                $(self).popover('hide');
            });
            $(self).popover('show');
        }

        //享受政策之鼠标悬停显示详细
        function showstandard(self,standard){
            $(self).popover({
                trigger:'manual',
                placement:'top',
                title:'补助标准',
                html:true,
                content:standard
            }).on('mouseleave',function(){
                $(self).popover('hide');
            });
            $(self).popover('show');
        }

        //分页之跳转
        function convert_page(curpage,allpage) {
            layui.use('layer', function() {
                var $ = layui.jquery, layer = layui.layer;

                layer.msg('<i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop" style="font-size: 86px;margin-top: 65px;"></i>', {
                    time: 30000, //30s后自动关闭
                    shade :0.1,
                    area: ['220px', '180px']
                });
            });

            var gopage = $("#pages").val();
            var numreg=/^[0-9]+$/g;
            var nomregok=numreg.test(gopage);
            if(nomregok==''||nomregok==0||!nomregok){
                return false;
            }
            else {
                $.ajax({
                    type: 'post',
                    datatype: 'json',
                    url: '/report_form/house_template_initial_paginator/',
                    data: {
                        'gopage':gopage,
                        'curpage':curpage,
                        'allpage':allpage
                    },
                    success: function (data) {
                        $("#down_show").html(data);
                        layer.closeAll();
                    }
                })
            }
        }

        //分页之上一页
        function last_page(curpage,allpage,pagetype) {
            layui.use('layer', function() {
                var $ = layui.jquery, layer = layui.layer;

                layer.msg('<i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop" style="font-size: 86px;margin-top: 65px;"></i>', {
                    time: 30000, //30s后自动关闭
                    shade :0.1,
                    area: ['220px', '180px']
                });
            });

            $.ajax({
                type:'post',
                datatype:'json',
                url:'/report_form/house_template_initial_paginator/',
                data:{
                    'curpage':curpage,
                    'allpage':allpage,
                    'pagetype':pagetype
                },
                success: function (data) {
                    $("#down_show").html(data);
                    layer.closeAll();
                }
            })
        }

        //分页之下一页
        function next_page(curpage,allpage,pagetype) {
            layui.use('layer', function() {
                var $ = layui.jquery, layer = layui.layer;

                layer.msg('<i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop" style="font-size: 86px;margin-top: 65px;"></i>', {
                    time: 30000, //30s后自动关闭
                    shade :0.1,
                    area: ['220px', '180px']
                });
            });

            $.ajax({
                type:'post',
                datatype:'json',
                url:'/report_form/house_template_initial_paginator/',
                data:{
                    'curpage':curpage,
                    'allpage':allpage,
                    'pagetype':pagetype
                },
                success: function (data) {
                    $("#down_show").html(data);
                    layer.closeAll();
                }
            })
        }

        //查询之关联下拉列表
        $(function() {
            $("#town_select").change(function () {
                $("#definition_select").empty().append('<option value="请选择">请选择</option>');
                var town = $("#town_select").val();
                $.ajax({
                    type:'post',
                    datatype:'json',
                    url:'/report_form/house_town_change/',
                    data:{'town':town},
                    success: function (res){
                        for(var i=0,len=res.village_name.length;i<len;i++){
                            var select_html="<option value="+res.village_name[i]+">"+res.village_name[i]+"</option>";
                            $("#definition_select").append(select_html);
                        }
                    }
                })
            })
        });

        //查询功能
        function commit_form(){
            layui.use('layer', function() {
                var $ = layui.jquery, layer = layui.layer;

                layer.msg('<i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop" style="font-size: 86px;margin-top: 65px;"></i>', {
                    time: 30000, //30s后自动关闭
                    shade :0.1,
                    area: ['220px', '180px']
                });
            });

            TOWN=$("#town_select").val();
            DEFINITION=$("#definition_select").val();
            HOUSEHOLDER=$("#householder").val();
            IDENTITY=$("#identity").val();
            HELPER=$("#helper").val();
            POOR=$("#poor_select").val();
            NUMBER=$("#number").val();
            REASON=$("#reason_select").val();

            $.ajax({
                type: 'post',
                datatype:'json',
                url: '/report_form/house_template_query_paginator/',
                data: {
                    "town":TOWN,
                    "definition":DEFINITION,
                    "householder":HOUSEHOLDER,
                    "identity":IDENTITY,
                    "helper":HELPER,
                    "poor":POOR,
                    "number":NUMBER,
                    "reason":REASON
                },
                success: function(data) {
                    $("#down_show").css("display","block");
                    $("#down_show").html(data);
                    layer.closeAll();
                }
            })
        }

        //分页之跳转（查询结果）
        function convert_page_query(curpage,allpage) {
            layui.use('layer', function() {
                var $ = layui.jquery, layer = layui.layer;

                layer.msg('<i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop" style="font-size: 86px;margin-top: 65px;"></i>', {
                    time: 30000, //30s后自动关闭
                    shade :0.1,
                    area: ['220px', '180px']
                });
            });

            var gopage = $("#pages").val();
            var numreg=/^[0-9]+$/g;
            var nomregok=numreg.test(gopage);
            if(nomregok==''||nomregok==0||!nomregok){
                return false;
            }
            else {
                $.ajax({
                    type: 'post',
                    datatype: 'json',
                    url: '/report_form/house_template_query_paginator/',
                    data: {
                        'gopage':gopage,
                        'curpage':curpage,
                        'allpage':allpage,
                        "town": TOWN,
                        "definition": DEFINITION,
                        "householder": HOUSEHOLDER,
                        "identity": IDENTITY,
                        "helper": HELPER,
                        "poor": POOR,
                        "number":NUMBER,
                        "reason":REASON
                    },
                    success: function (data) {
                        $("#down_show").html(data);
                        layer.closeAll();
                    }
                })
            }
        }

        //分页之上一页（查询结果）
        function last_page_query(curpage,allpage,pagetype) {
            layui.use('layer', function() {
                var $ = layui.jquery, layer = layui.layer;

                layer.msg('<i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop" style="font-size: 86px;margin-top: 65px;"></i>', {
                    time: 30000, //30s后自动关闭
                    shade :0.1,
                    area: ['220px', '180px']
                });
            });

            $.ajax({
                type:'post',
                datatype:'json',
                url:'/report_form/house_template_query_paginator/',
                data:{
                    'curpage':curpage,
                    'allpage':allpage,
                    'pagetype':pagetype,
                    "town": TOWN,
                    "definition":DEFINITION,
                    "householder":HOUSEHOLDER,
                    "identity":IDENTITY,
                    "helper":HELPER,
                    "poor":POOR,
                    "number":NUMBER,
                    "reason":REASON
                },
                success: function (data) {
                    $("#down_show").html(data);
                    layer.closeAll();
                }
            })
        }

        //分页之下一页（查询结果）
        function next_page_query(curpage,allpage,pagetype) {
            layui.use('layer', function() {
                var $ = layui.jquery, layer = layui.layer;

                layer.msg('<i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop" style="font-size: 86px;margin-top: 65px;"></i>', {
                    time: 30000, //30s后自动关闭
                    shade :0.1,
                    area: ['220px', '180px']
                });
            });

            $.ajax({
                type:'post',
                datatype:'json',
                url:'/report_form/house_template_query_paginator/',
                data:{
                    'curpage':curpage,
                    'allpage':allpage,
                    'pagetype':pagetype,
                    "town": TOWN,
                    "definition":DEFINITION,
                    "householder":HOUSEHOLDER,
                    "identity":IDENTITY,
                    "helper":HELPER,
                    "poor":POOR,
                    "number":NUMBER,
                    "reason":REASON
                },
                success: function (data) {
                    $("#down_show").html(data);
                    layer.closeAll();
                }
            })
        }

        //显示所有按钮
        function show_data() {
            layui.use('layer', function() {
                var $ = layui.jquery, layer = layui.layer;

                layer.msg('<i class="layui-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop" style="font-size: 86px;margin-top: 65px;"></i>', {
                    time: 30000, //30s后自动关闭
                    shade :0.1,
                    area: ['220px', '180px']
                });
            });

            window.location.href='/report_form/poorhousedataform/';
        }
    </script>
{% endblock %}